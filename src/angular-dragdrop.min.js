var jqyoui=angular.module("jqyoui",[]).directive("jqyouiDraggable",function(){return{require:"?jqyouiDroppable",restrict:"A",link:function(e,t,n){var r;var i=function(i,s){if(i){r=e.$eval(t.attr("jqyoui-draggable"))||[];t.draggable({disabled:false}).draggable(e.$eval(n.jqyouiOptions)||{}).draggable({start:function(t,n){$(this).css("z-index",99999);jqyoui.startXY=$(this).offset();if(r.onStart){e[r.onStart](t,n)}},stop:function(t,n){if(r.onStop){e[r.onStop](t,n)}},drag:function(t,n){if(r.onDrag){e[r.onDrag](t,n)}}})}else{t.draggable({disabled:true})}};e.$watch(function(){return e.$eval(n.drag)},i);i()}}}).directive("jqyouiDroppable",["$timeout",function(e){return{restrict:"A",priority:1,link:function(t,n,r){var i=function(i,s){if(s){n.droppable({disabled:false}).droppable(t.$eval(r.jqyouiOptions)||{}).droppable({over:function(e,n){var r=t.$eval(angular.element(this).attr("jqyoui-droppable"))||[];if(r.onOver){t[r.onOver](e,n)}},out:function(e,n){var r=t.$eval(angular.element(this).attr("jqyoui-droppable"))||[];if(r.onOut){t[r.onOut](e,n)}},drop:function(n,r){jqyoui.invokeDrop(angular.element(r.draggable),angular.element(this),t,e,n,r)}})}else{n.droppable({disabled:true})}};t.$watch(function(){return t.$eval(r.drop)},i);i()}}}]);jqyoui.invokeDrop=function(e,t,n,r,i,s){var o="",u="",a={},f={},l=null,c={},h={},p=null;o=e.attr("ng-model");u=t.attr("ng-model");p=t.find("[jqyoui-draggable]:last");f=n.$eval(t.attr("jqyoui-droppable"))||[];a=n.$eval(e.attr("jqyoui-draggable"))||[];l=angular.isArray(n[o])?a.index:null,c=angular.isArray(n[o])?n[o][l]:n[o];h=(angular.isArray(n[u])&&f&&f.index!==undefined?n[u][f.index]:!angular.isArray(n[u])?n[u]:{})||{};if(a.animate===true){jqyoui.move(e,p.length>0?p:t,null,"fast",f,null);jqyoui.move(p.length>0&&!f.multiple?p:[],e.parent("[jqyoui-droppable]"),jqyoui.startXY,"fast",f,function(){r(function(){e.css({position:"relative",left:"",top:""});p.css({position:"relative",left:"",top:""});jqyoui.mutateDraggable(n,f,a,o,u,h,e);jqyoui.mutateDroppable(n,f,a,u,c,l);if(f.onDrop){n[f.onDrop](i,s)}})})}else{r(function(){jqyoui.mutateDraggable(n,f,a,o,u,h,e);jqyoui.mutateDroppable(n,f,a,u,c,l);if(f.onDrop){n[f.onDrop](i,s)}})}};jqyoui.move=function(e,t,n,r,i,s){if(e.length===0){if(s){window.setTimeout(function(){s()},300)}return false}var o=9999,u=e.offset(),a=t&&t.is(":visible");if(n===null&&t.length>0){if(t.attr("jqyoui-draggable")!==undefined&&t.attr("ng-model")!==undefined&&t.is(":visible")&&i&&i.multiple){n=t.offset();if(i.stack===false){n.left+=t.outerWidth(true)}else{n.top+=t.outerHeight(true)}}else{n=t.css({visibility:"hidden",display:"block"}).offset();t.css({visibility:"",display:a?"":"none"})}}e.css({position:"absolute","z-index":o}).css(u).animate(n,r,function(){if(s)s()})};jqyoui.mutateDroppable=function(e,t,n,r,i,s){if(angular.isArray(e[r])){if(t&&t.index>=0){e[r][t.index]=i}else{e[r].push(i)}if(n&&n.placeholder){e[r][e[r].length-1]["jqyoui_pos"]=s}}else{e[r]=i;if(n&&n.placeholder){e[r]["jqyoui_pos"]=s}}};jqyoui.mutateDraggable=function(e,t,n,r,i,s,o){var u=$.isEmptyObject(s);if(n&&n.placeholder){if(angular.isArray(e[r])&&!angular.isArray(e[i])){e[r][n.index]=s}else if(!angular.isArray(e[i])){e[r]=s}else if(n.index!==undefined){e[r][n.index]=s}else{e[r]=s}}else{if(angular.isArray(e[r])&&$.isEmptyObject(s)){e[r].splice(n.index,1)}else if(angular.isArray(e[r])&&angular.isArray(e[r])){if(u){e[r].splice(n.index,1)}else{e[r][n.index]=s}}else if(angular.isArray(e[r])&&!angular.isArray(e[r])){e[r][n.index]=s}else{e[r]=s;if(e.$parent)e.$parent[r]=s}}o.css({"z-index":"",left:"",top:""})}